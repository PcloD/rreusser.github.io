<!DOCTYPE html>
<html class='no-js sticky'>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <title>Hyperbolic Grid Generation | Ricky Reusser</title>
    <meta name="og:image" content="https://s3.amazonaws.com/images.rickyreusser.com/DSC_0699.JPG" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="description" content="The governing equations of aerodynamics are actually pretty intuitively simple, but actually solving practical engineering problems is [way too fundamentally difficult](http://www.claymath.org/millennium-problems/navier%E2%80%93stokes-equation) for all but the simplest of problems. Engineering is about useful approximations though, and the first step of discretization, the process of turning an exact but unsolvable problem into a bunch of immensely easier approximate problems, is to generate a grid on which to solve the problem." />
    <meta name="site" content="Ricky Reusser" />
    <meta name="og:site_name" content="Ricky Reusser" />
    <meta name="title" content="Hyperbolic Grid Generation" />
    <meta name="twitter:title" content="Hyperbolic Grid Generation" />
    <meta name="twitter:site" content="@rickyreusser" />
    <meta name="twitter:image:src" content="https://s3.amazonaws.com/images.rickyreusser.com/DSC_0699.JPG" />
    <meta name="og:title" content="Hyperbolic Grid Generation" />
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <link href="../../../../stylesheets/application-8c0872f0.css" rel="stylesheet" type="text/css" />
    <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/default.min.css' rel='stylesheet'>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG"></script>
    <script>
      MathJax.Hub.Config({
        'HTML-CSS': {
          scale: 115
        }
      })
    </script>
  </head>
  <body>
    <div class='wrapper'>
      <nav class='navbar' id='navbar'>
        <a class="menu-toggle" href="/"><span class='burger'></span>
        <span class='burger'></span>
        <span class='burger'></span>
        </a>
        <ul id='menu'>
          <li class='top'>
            <a class="brand" href="/">rickyreusser.com
            </a>
          </li>
          <li>
            <div class='padding-container'></div>
            <a href="/tags/science"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            	 width="72px" height="72px" viewBox="0 0 72 72" enable-background="new 0 0 72 72" xml:space="preserve">
              <g>
                <circle fill="#ffffff" cx="37.915" cy="34.252" r="2.165"/>
                <circle fill="#ffffff" cx="35.086" cy="34.252" r="2.165"/>
                <circle fill="#ffffff" cx="37.915" cy="37.08" r="2.165"/>
                <circle fill="#ffffff" cx="35.086" cy="37.08" r="2.165"/>
                <circle fill="#ffffff" cx="59.5" cy="43.666" r="3.888"/>
                <ellipse fill="none" stroke="#ffffff" stroke-width="3" stroke-miterlimit="10" cx="36.5" cy="35.666" rx="33.333" ry="11.167"/>
                <circle fill="#ffffff" cx="18.39" cy="51.134" r="3.889"/>
                
                  <ellipse transform="matrix(-0.4996 0.8662 -0.8662 -0.4996 85.7024 20.9105)" fill="none" stroke="#ffffff" stroke-width="3" stroke-miterlimit="10" cx="36.812" cy="35.207" rx="33.333" ry="11.167"/>
                <circle fill="#ffffff" cx="32.201" cy="12.24" r="3.889"/>
                
                  <ellipse transform="matrix(-0.4988 -0.8667 0.8667 -0.4988 23.7217 86.0485)" fill="none" stroke="#ffffff" stroke-width="3" stroke-miterlimit="10" cx="36.74" cy="36.166" rx="33.333" ry="11.167"/>
              </g>
            </svg>
            <span class='label'>science</span>
            </a>
          </li>
          <li>
            <div class='padding-container'></div>
            <a href="/tags/dev"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            	 width="72px" height="72px" viewBox="0 0 72 72" enable-background="new 0 0 72 72" xml:space="preserve">
              <g>
                <path fill="#ffffff" d="M25.295,28.367l-14.941,7.489l14.941,7.42v4.284l-18.58-9.784v-3.886l18.58-9.784V28.367z"/>
                <path fill="#ffffff" d="M41.468,15.914h3.34L30.991,55.308h-3.357L41.468,15.914z"/>
                <path fill="#ffffff" d="M47.06,28.367v-4.261l18.58,9.784v3.886l-18.58,9.784v-4.284l14.941-7.42L47.06,28.367z"/>
              </g>
            </svg>
            <span class='label'>dev</span>
            </a>
          </li>
          <li>
            <div class='padding-container'></div>
            <a id="fun" href="/tags/fun"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            	 width="72px" height="72px" viewBox="0 0 72 72" enable-background="new 0 0 72 72" xml:space="preserve">
              <g>
                <path fill="none" stroke="#ffffff" stroke-width="3" stroke-miterlimit="10" d="M54.566,58.368"/>
                <path fill="#ffffff" d="M54.244,40.188l-7.595,4.933L25.393,13.908L2.23,58.5h67.697L54.244,40.188z M25.707,19.157l7.821,11.502
                  l-1.919,5.119l-5.349-7.932l-3.208,5.65l-1.992-5.403L25.707,19.157z"/>
              </g>
            </svg>
            <span class='label'>fun</span>
            </a>
          </li>
          <li>
            <div class='padding-container'></div>
            <a href="https://github.com/rreusser"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            	 width="72px" height="72px" viewBox="0 0 72 72" enable-background="new 0 0 72 72" xml:space="preserve">
            <path fill-rule="evenodd" clip-rule="evenodd" fill="#ffffff" d="M36.21,8.152C20.488,8.152,7.738,20.9,7.738,36.629
            	c0,12.579,8.158,23.251,19.474,27.017c1.424,0.262,1.943-0.618,1.943-1.372c0-0.676-0.024-2.467-0.038-4.843
            	c-7.921,1.721-9.592-3.817-9.592-3.817c-1.295-3.289-3.161-4.165-3.161-4.165c-2.586-1.767,0.195-1.73,0.195-1.73
            	c2.857,0.201,4.361,2.934,4.361,2.934c2.54,4.352,6.664,3.096,8.287,2.366c0.258-1.84,0.994-3.095,1.808-3.807
            	c-6.323-0.719-12.971-3.161-12.971-14.072c0-3.109,1.11-5.65,2.932-7.641c-0.293-0.721-1.271-3.616,0.278-7.536
            	c0,0,2.392-0.766,7.831,2.919c2.271-0.632,4.707-0.947,7.128-0.958c2.417,0.011,4.855,0.326,7.13,0.958
            	c5.434-3.685,7.82-2.919,7.82-2.919c1.555,3.92,0.578,6.815,0.283,7.536c1.826,1.99,2.926,4.531,2.926,7.641
            	c0,10.938-6.656,13.345-13,14.05c1.023,0.88,1.934,2.617,1.934,5.273c0,3.807-0.035,6.878-0.035,7.812
            	c0,0.761,0.514,1.647,1.959,1.369c11.305-3.772,19.455-14.438,19.455-27.014C64.686,20.9,51.936,8.152,36.21,8.152z"/>
            </svg>
            <span class='label'>github</span>
            </a>
          </li>
          <li>
            <div class='padding-container'></div>
            <a href="/about"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            	 width="72px" height="72px" viewBox="0 0 72 72" enable-background="new 0 0 72 72" xml:space="preserve">
              <path fill="#ffffff" d="M53.5,55.333c-9.984-2.463-11.438-6.349-10.25-8.583c1.041-1.96,2.268-1.829,5.464-9.761
                c0.094,0.036,0.182,0.084,0.282,0.106c1.588,0.356,3.365-1.132,3.965-3.326c0.598-2.191-0.207-4.261-1.794-4.617
                c-0.083-0.019-0.168-0.012-0.252-0.021C54.667,8.497,38.667,5.997,30.167,11.247c-3.917-2.359-12.25,1.917-10.068,17.885
                c-0.084,0.009-0.155,0.002-0.238,0.021c-1.587,0.356-2.392,2.426-1.794,4.617c0.6,2.194,2.377,3.683,3.965,3.326
                c0.101-0.022,0.188-0.07,0.282-0.106c3.196,7.932,4.271,7.988,5.312,9.948c1.188,2.234,0.231,5.982-9.745,8.477
                C4.546,58.747,5.527,65.5,5.527,65.5H35.5h30C65.5,65.5,66.666,58.581,53.5,55.333z"/>
            </svg>
            <span class='label'>about me</span>
            </a>
          </li>
          <li>
            <div class='padding-container'></div>
            <a href="/feed.xml"><?xml version="1.0" encoding="utf-8"?>
            <!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
            <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
            <svg version="1.1" id="rss-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            	 width="72px" height="72px" viewBox="0 0 72 72" enable-background="new 0 0 72 72" xml:space="preserve">
            <g>
            	<path fill="#FFFFFF" d="M16.641,48.311c-3.875,0-7.023,3.16-7.023,7.012c0,3.873,3.148,6.998,7.023,6.998
            		c3.889,0,7.033-3.125,7.033-6.998C23.674,51.471,20.53,48.311,16.641,48.311z"/>
            	<path fill="#FFFFFF" d="M9.626,27.546v10.112c6.584,0,12.776,2.575,17.439,7.24c4.658,4.654,7.229,10.874,7.229,17.482h10.157
            		C44.451,43.172,28.824,27.546,9.626,27.546z"/>
            	<path fill="#FFFFFF" d="M9.638,9.618v10.118c23.485,0,42.6,19.133,42.6,42.645h10.143C62.381,33.296,38.718,9.618,9.638,9.618z"/>
            </g>
            </svg>
            <span class='label'>feed</span>
            </a>
          </li>
        </ul>
        <div class='content'></div>
        <div class='inner-content'>
          <h5 class='abbrev'>
            <span>Hyperbolic Grid Generation</span>
          </h5>
        </div>
      </nav>
      <article>
        <section class='frontmatter' data-abbrvd-target='#navbar'>
          <div class='container'>
            <div class='outer-container'>
              <div class='inner-container'>
                <h1 class='title'>Hyperbolic Grid Generation</h1>
                <h5 class='metadata'>
                  <span class='author'>Ricky Reusser</span>
                  <br>
                  <span class='published-at'>February 07, 2016</span>
                  <br>
                  <div class='tags'>
                    <span class='tag'><a href="/tags/dev/">#dev</a></span>
                    <span class='tag'><a href="/tags/engineering/">#engineering</a></span>
                    <span class='tag'><a href="/tags/aerodynamics/">#aerodynamics</a></span>
                    <span class='tag'><a href="/tags/science/">#science</a></span>
                  </div>
                </h5>
              </div>
            </div>
          </div>
        </section>
        <section class='content'>
          <h2>The motivation</h2>
          
          <p>The governing equations of aerodynamics are actually pretty intuitively simple, but actually solving practical engineering problems is <a href="http://www.claymath.org/millennium-problems/navier%E2%80%93stokes-equation">way too fundamentally difficult</a> for all but the simplest of problems. Engineering is about useful approximations though, and the first step of discretization, the process of turning an exact but unsolvable problem into a bunch of immensely easier approximate problems, is to generate a grid on which to solve the problem.</p>
          
          <figure>
            <img alt="Basically the grid-generation problem I'm trying to solve here." src="/hyperbolic-grid-generation/naive-method-ecd324eb.png">
            <figcaption>Basically the grid-generation problem I&rsquo;m trying to solve here.</figcaption>
          </figure>
          
          <p>Oh, and of course I should point out that the primary motivation for me actually writing this up and putting it out here on the web is to try to figure out what all the reports I did years ago would have looked like if I&rsquo;d had a set of tools on hand that allowed me to communicate things interactively. <a href="http://blog.codinghorror.com/the-principle-of-least-power/">The trend of porting everything to JavaScript</a> gets really old, but as rightfully maligned as it is, it does allow for a unique combination of portability and interactivity that I don&rsquo;t think are very well utilized yet. So my goal here is to create marginally interesting things but also to refine the tools so that other people can create more interesting things.</p>
          
          <p>So anyway, imagine trying to figure out how much lift and drag an airfoil produces. Unless airflow over the airfoil is laminar (smooth) and maybe even has a <a href="https://en.wikipedia.org/wiki/Joukowsky_transform">clever analytical solution</a>, we&rsquo;ll need a grid. Since we don&rsquo;t really care where our grid ends as long as it&rsquo;s far away, the obvious approach is to start at the airfoil and march a contour outward.</p>
          
          <p>The example below marches a grid concentrically outward, offsetting the grid by a constant distance at each step. It has a big problem though. As the camber (curvature) of the airfoil increases, mesh eventually runs into itself, making fun patterns that unfortunately aren&rsquo;t very useful.</p>
          
          <figure class="wide">
          <p><code>interactive-frame[width=100% height=600 border=#eee](http://rickyreusser.com/grid-generation-experiments/?configSet=1&closeButton=false&stepInc=0&stepStart=0.025&clustering=4&camber=0.25&xmin=-0.8&xmax=1.8&n=22&diffusion=0.006&integrator=euler&alpha=0&mouseWheel=false&ymin=0.15&ymax=0.15)</code></p>
          <figcaption>The constant-offest approach produces grids that may run into&nbsp;themselves. A cell-area-preserving tendency (\(\alpha\)) fights this.</figcaption>
          </figure>
          
          <p>The problem above is that nothing prevents concentric contours from forming cusps as the grid lines start to intersect. To fix this, we can try forcing areas at risk of collapsing to bulge outward. In other words, cells that get narrow in the around-direction can get longer in the outward-direction. Calling this area-preserving tendency <code>\(\alpha\)</code>, we confirm above that keeping cell area constant as we march outward fixes our grid.</p>
          
          <p>A simple approach like this is what we&rsquo;re aiming for, but I&rsquo;ve had to gloss over some numerical surprises to get it to look so straightforward. Let&rsquo;s write down the equations we need need to see how this all works.</p>
          
          <h2>The math</h2>
          
          <p>Two conditions define our strategy as we march outward:</p>
          
          <ol>
          <li>Grid lines should stay perpendicular.</li>
          <li>Cell area should stay the same.</li>
          </ol>
          
          <p>Later on, the first condition will make the aerodynamics part much easier since lots of terms simply vanish when the grid is orthogonal, and the second condition prevents the problems we ran into above.</p>
          
          <p>We&rsquo;ll start by parameterizing the grid. We&rsquo;ll call distance around the airfoil <code>\(\eta\)</code> and the outward parameter <code>\(\xi\)</code> (that&rsquo;s the Greek letter &ldquo;xi&rdquo;, but we liked to call it &ldquo;tornado&rdquo; in school).</p>
          
          <figure>
            <img alt="The basic coordinates of our grid generation problem." src="/hyperbolic-grid-generation/airfoil-f7c6e695.png">
            <figcaption>The basic coordinates of our grid generation problem.</figcaption>
          </figure>
          
          <p>A single grid cell looks like this:</p>
          
          <figure>
            <image src="/hyperbolic-grid-generation/computational-cell-beb025f0.png" width="350" alt="A cute little grid cell">
            <figcaption>A single grid cell in our physical domain.</figcaption>
          </figure>
          
          <p>If we write the sides of this cell as vectors <code>\(\left(\frac{\partial x}{\partial \eta}, \frac{\partial y}{\partial \eta}\right)\)</code> and <code>\(\left(\frac{\partial x}{\partial \xi}, \frac{\partial y}{\partial \xi}\right)\)</code>, then conditions (1) and (2) state identically that the dot product of the vectors representing the sides is zero (i.e. the sides are perpendicular) and that the cross product of the sides (i.e. the area) is a constant. In equation form,</p>
          
          <p><code>$$ \left\{ \begin{eqnarray} x_\xi x_\eta + y_\xi y_\eta &amp;=&amp; 0  \\ x_\xi y_\eta - x_\eta y_\xi &amp;=&amp; A(\xi,\eta) \end{eqnarray} \right.$$</code></p>
          
          <p>where the dependence of <code>\(A\)</code> on <code>\(\xi\)</code> and <code>\(\eta\)</code> just means we&rsquo;ll leave room to take some liberties with our &lsquo;constant&rsquo; and maybe tweak the area rule (while maintaining orthogonality, of course) so that we get the best grid we can. Some quick reorganization yields the equations</p>
          
          <p><code>$$ \begin{equation} \left\{\begin{array}{c} x_\xi\\y_\xi\end{array}\right\} = -\frac{A(\xi,\eta)}{x_\eta^2+y_\eta^2} \left\{\begin{array}{c} -y_\eta\\x_\eta \end{array}\right\}. \end{equation} $$</code></p>
          
          <p>Since we know <code>\(x_\eta\)</code> and <code>\(y_\eta\)</code>, and <code>\(A(\xi, \eta)\)</code> is just a function we can make up, this means we have everything we need to just march it outward. Piece of cake.</p>
          
          <figure class="wide">
            <p><code>interactive-frame[width=100% height=600 border=#eee](http://rickyreusser.com/grid-generation-experiments/?stepInc=0.002&m=101&n=20&stepStart=0.001&clustering=1.5&camber=0.02&xmin=-0.5&xmax=1.5&diffusion=0&integrator=rk4&mouseWheel=false&configSet=2)</code></p>
            <figcaption>Plugging this into an explicit ODE integrator turns out not to work so well. A quick cheat is to add some diffusion and blur the perturbations away.</figcaption>
          </figure>
          
          <p>It wasn&rsquo;t immediately clear to me why this method would be so unstable. The equations are very similar in form to the first order wave equation <code>$$\frac{\partial f}{\partial t} = c\frac{\partial f}{\partial x}.$$</code> Lower order time integration and spatial differencing tends to be somewhat unstable for the first order wave equation, but it typically only takes a little bit of effort and some second order methods to at least acheive a stable if not highly accurate solution. It didn&rsquo;t really dawn on me that <a href="https://github.com/scijs/ode-rk4">fourth order Runge-Kutta</a> integration in <code>\(\xi\)</code> and <a href="https://github.com/scijs/finite-difference-stencil">sixth-order compact finite differences</a> in <code>\(\eta\)</code> might <em>not</em> work, but as it turns out, high order methods don&rsquo;t really help at all.</p>
          
          <h2>In search of stability</h2>
          
          <p>To understand why the solution is so unstable, we turn to Fourier analysis. Problems that are difficult to analyze in space and time are often much simpler to analyze in the frequency domain. To that end, we&rsquo;ll seek to represent the relative growth <code>\(y(\xi+\Delta \xi, \eta) / y(\xi,\eta)\)</code> and <code>\(x(\xi+\Delta \xi, \eta) / x(\xi,\eta)\)</code> over a single step. If the modulus of these growth factors is greater than one, then with repeated steps, our solution grows exponentially and we observe the instability we saw above.</p>
          
          <p>Taking a Fourier transform in the <code>\(\eta\)</code>-direction, we write our state as <code>$$\left\{\begin{eqnarray} x &amp;=&amp; \hat{x}(\xi) e^{i k_x \eta} \\ y &amp;=&amp; \hat{y}(\xi) e^{i k_y \eta}\end{eqnarray}\right.$$</code> Since the interesting cases are the ones where <code>\(x\)</code> and <code>\(y\)</code> interact, we&rsquo;ll equate <code>\(k_x\)</code> and <code>\(k_y\)</code>. And for simplicity, we&rsquo;ll look at a first-order Euler step from step <code>\(n \, (= \xi)\)</code> to <code>\(n+1 \, (= \xi + \Delta \xi)\)</code> and an exact derivative in the <code>\(\eta\)</code>-direction so that the full update for each step outward becomes <code>$$\left\{\begin{eqnarray}\frac{\hat{x}_{n+1} e^{ik\eta} - \hat{x}_n e^{ik\eta}}{\Delta \xi} &amp;=&amp; \phantom{-} \frac{A (i k \hat{y}_n e^{i k \eta})}{|ik\hat{x}_n|^2 + |ik \hat{y}_n|^2} \\ \frac{\hat{y}_{n+1} e^{ik\eta} - \hat{y}_n e^{ik\eta}}{\Delta \xi} &amp;=&amp; - \frac{A (i k \hat{x}_n e^{i k \eta})}{|ik\hat{x}_n|^2 + |ik\hat{y}_n|^2}\\ \end{eqnarray}\right..$$</code>
          Simplifying a bit yields <code>$$\left\{ \begin{eqnarray} \hat{x}_{n+1} &amp;=&amp; \hat{x}_n - i \frac{ A \Delta \xi}{k} \frac{\hat{y}_n}{|\hat{x}_n|^2 + |\hat{y}_n|^2} \\ \hat{y}_{n+1} &amp;=&amp; \hat{y}_n + i \frac{ A \Delta \xi}{k} \frac{\hat{x}_n}{|\hat{x}_n|^2 + |\hat{y}_n|^2} \\ \end{eqnarray}\right.$$</code>
          To get the relative change over a single step, we divide through by <code>\(\hat{x}_n\)</code> and <code>\(\hat{y}_n\)</code> to get <code>$$\left\{ \begin{eqnarray} \frac{\hat{x}_{n+1}}{\hat{x}_n} &amp;=&amp; 1 - i \left[\frac{ A \Delta \xi}{k(|\hat{x}_n|^2 + |\hat{y}_n|^2)} \right] \frac{\hat{y}_n}{\hat{x}_n} \\ \frac{\hat{y}_{n+1}}{\hat{y}_n} &amp;=&amp; 1 + i \left[\frac{ A \Delta \xi}{k (|\hat{x}_n|^2 + |\hat{y}_n|^2)}\right] \frac{\hat{x}_n}{\hat{y}_n} \\ \end{eqnarray}\right.$$</code>
          As a sanity check, note that if <code>\(\Delta \xi = 0\)</code>, i.e. if the step size outward is zero, then <code>\(\hat{x}_{n+1}/\hat{x}_n\) = \(\hat{y}_{n+1}/\hat{y}_n = 1\)</code> and the solution remains unchanged. Since the term in brackets is a real number that can be made arbitrarily small by taking a smaller step, we&rsquo;ll just call it <code>\(\epsilon\)</code> to get <code>$$\left\{ \begin{eqnarray} \frac{\hat{x}_{n+1}}{\hat{x}_n} &amp;=&amp; 1 - i \epsilon \frac{\hat{y}_n}{\hat{x}_n} \\ \frac{\hat{y}_{n+1}}{\hat{y}_n} &amp;=&amp; 1 + i \epsilon \frac{\hat{x}_n}{\hat{y}_n} \\ \end{eqnarray}\right.$$</code> If we let <code>\(\hat{y}_n/\hat{x}_n = re^{i\theta} = r\cos(\theta) + ir\sin(\theta)\)</code>, then we see at last that <code>$$\left\{ \begin{eqnarray} \frac{\hat{x}_{n+1}}{\hat{x}_n} &amp;=&amp; 1 - i r \epsilon \cos(\theta) + r \epsilon \sin(\theta) \\ \frac{\hat{y}_{n+1}}{\hat{y}_n} &amp;=&amp; 1 + \frac{i\epsilon}{r} \cos(\theta) + \frac{\epsilon}{r} \sin(\theta) \\ \end{eqnarray}\right.$$</code>
          defines our step. <code>\(\epsilon\)</code> is a small number and <code>\(r\)</code> and <code>\(\theta\)</code> come from the relation of <code>\(x\)</code> to <code>\(y\)</code> so that we don&rsquo;t really have any control over them. To make a long story short, plotting the growth factor for a single <code>\(\xi\)</code>-step on the unit circle below shows that there&rsquo;s no <code>\(\Delta \xi\)</code> small enough to keep things stable.</p>
          
          <figure>
            <img alt="A simple step throws the solution outside the region of stability." src="/hyperbolic-grid-generation/stability-5d0477e2.png">
            <figcaption>A simple `\(\xi-\)`step throws the solution outside the region of stability.</figcaption>
          </figure>
          
          <p>The best we can do and indeed what people seem to do is to add diffusion. In terms of stability, diffusion pulls things toward the origin of the complex plane and back inside the region of stability (the unit circle). The downside is that when we smooth out the bumps with diffusion, we also lose a bit of the orthogonality we were aiming for.</p>
          
          <p>With some diffusion to keep things stable, the final result is below. In lieu of all of these caveats, it works reasonably well! In a future writeup, I&rsquo;ll try to use this to do some actual fluid dynamics. You can find the code on <a href="https://github.com/rreusser/grid-generation-experiments">github</a>.</p>
          
          <figure class="wide">
          <p><code>interactive-frame[width=100% height=600 border=#eee](http://rickyreusser.com/grid-generation-experiments/?stepInc=0.002&m=201&n=40&stepStart=0.002&clustering=15&camber=0.25&xmin=-0.3&xmax=1.3&diffusion=0.001&integrator=rk2&mouseWheel=false&ymin=0.1&ymax=0.1)</code></p>
            <figcaption>Hyperbolic grid generation with parabolic smoothing.</figcaption>
          </figure>
        </section>
      </article>
      <div class='push'></div>
    </div>
    <section class='footer'>
      <div class='container'>
        <div class='article-footer'>
          <div id='disqus_thread'></div>
          <script>
              var disqus_shortname = 'rickyreusser';
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>
            Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
          </noscript>
        </div>
        <!--div class="sharing">
        <a href="http://www.twitter.com/share?url=<%= data['site']['siteurl'] %><%= current_article.url %>&amp;text=<%= current_article.title %> by <%= data['site']['twitter_id'] %>" title="Share this post on Twitter" data-lang="en" onclick="return !window.open(this.href, 'Twitter', 'width=640,height=300')"><span class="socicon socicon-twitter fgcolor"></span></a>
        <a target="_blank" onclick="return !window.open(this.href, 'Facebook', 'width=640,height=300')" href="http://www.facebook.com/sharer/sharer.php?u=<%= data['site']['siteurl'] %><%= current_article.url %>" title="Share this post on Facebook"><span class="socicon socicon-facebook fgcolor"></span></a>
        <a href="http://plus.google.com/share?url=<%= data['site']['siteurl'] %><%= current_article.url %>" target="_blank" onclick="return !window.open(this.href, 'Google +', 'width=640,height=300')" title="Share this post on Google +"><span class="socicon socicon-google fgcolor"></span></a>
        </div-->
      </div>
    </section>
    <script src="../../../../javascripts/all-7c4f32d1.js" type="text/javascript"></script>
    <script>
      var _gaq=[['_setAccount','UA-50197543-4'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
    </script>
    <script>
      $('code').each(function(i,el) {
        var $el = $(el);
        var html = $el.html();
        if( html.match(/^\${1,2}.*\${1,2}$/) || html.match(/^\\\(.*\\\)$/) ){
          var container = $('<span>');
          container.html(html);
          $el.replaceWith(container);
        }
      });
    </script>
  </body>
</html>
