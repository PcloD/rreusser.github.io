window.RR=window.RR||{},window.RR.SlideShow=function(i,t,s){function e(t,e){e=s.extend({priority:0},e),this.$el=s("<img>").addClass("slide-image slide-hidden").addClass(e["class"]),this.img=this.$el[0],this.priority=e.priority,this.setDimensions=function(){this.width=this.img.naturalWidth,this.height=this.img.naturalHeight,this.ar=this.width/this.height}.bind(this),this.calculatePosition=function(){this.setDimensions(),i.innerHeight*this.ar>i.innerWidth&&(this.actualWidth=i.innerWidth),i.innerWidth/this.ar>i.innerHeight&&(this.actualWidth=i.innerHeight*this.ar),this.actualHeight=this.actualWidth/this.ar},this.position=function(){this.calculatePosition(),this.$el.removeClass("slide-hidden"),this.$el.css({width:this.actualWidth,left:Math.floor(.5*i.innerWidth-.5*this.actualWidth),top:Math.floor(.5*i.innerHeight-.5*this.actualHeight)})}.bind(this),this.onResize=function(){s(i).on("resize",this.position)},this.offResize=function(){s(i).off("resize",this.position)},this.load=function(i){this.img.complete&&void 0!==this.img.src&&this.img.src.length>0?(this.setDimensions(),i(),this.position(),this.onResize()):(this.$el.one("load",function(){this.setDimensions(),i(),this.position(),this.onResize()}.bind(this)),this.img.src=t)}.bind(this)}function h(i){i=s.extend(i,{}),this.$spinner=i.spinner,this.loading=!1,this.hideSpinner(),this.queue=[]}function n(i,t,h){h=s.extend({},h),this.host=i,this.data=t.images,this.queue=h.queue,this.preview=new e(this.host+t.versions.thumb.path,{"class":"slide-preview",priority:2}),this.image=new e(this.host+t.versions.half.path,{"class":"slide-full",priority:1}),this.$el=s("<div>").addClass("slide"),this.$el.append(this.preview.$el),this.$el.append(this.image.$el)}function o(t){this.slides=[],this.slide_data=i[t+"_data"],this.$el=s("[data-slide-show="+t+"]"),this.$label=s(".navbar .inner-content span"),this.$labelBase=this.$label.text(),this.$spinner=this.$el.find(".slide-spinner"),this.createSpinner(this.$spinner),this.queue=new h({spinner:this.$spinner}),i.queue=this.queue,this.cursor=0,this.parseData(),this.removePreview(),this.setCursorFromHash(),this.bindKeys(),this.bindMouse(),this.bindHash(),this.controlTimeout=void 0,this.showControls()}return h.prototype.showSpinner=function(){this.$spinner&&this.$spinner.show&&this.$spinner.show()},h.prototype.hideSpinner=function(){this.$spinner&&this.$spinner.hide&&this.$spinner.hide()},h.prototype.loaded=function(){this.loading=!1,this.hideSpinner(),this.next()},h.prototype.push=function(i){this.queue.push(i),this.next()},h.prototype.nextIndex=function(){for(var i=0,t=0;t<this.queue.length;t++)i=Math.max(this.queue[t].priority||0,i);for(var t=0;t<this.queue.length;t++)if(this.queue[t].priority==i)return t;return 0},h.prototype.next=function(){if(!this.loading){var i=this.nextIndex(),t=this.queue.splice(i,1)[0];t&&(this.loading=!0,this.showSpinner(),t.load(this.loaded.bind(this)))}},n.prototype.preload=function(){this.queue.push(this.preview),this.queue.push(this.image)},o.prototype.showControls=function(){s(".slide-show").addClass("slide-controls"),clearTimeout(this.controlTimeout),this.controlTimeout=setTimeout(function(){s(".slide-show").removeClass("slide-controls")},3500)},Object.defineProperties(o.prototype,{length:{get:function(){return this.slides.length}}}),o.prototype.removePreview=function(){this.$el.find(".slide-show-preview").remove()},o.prototype.parseData=function(){for(var i=0;i<this.slide_data.images.length;i++)this.slides.push(new n(this.slide_data.host,this.slide_data.images[i],{queue:this.queue}))},o.prototype.next=function(){this.show((this.cursor+1+this.length)%this.length)},o.prototype.prev=function(){this.show((this.cursor-1+this.length)%this.length)},o.prototype.loadNeighborhood=function(){this.slides[this.cursor].preload();for(var i=1;10>i;i++)for(var t=1;t>=-1;t-=2){var s=Math.max(0,Math.min(this.length-1,(this.cursor+i*t+2*this.length)%this.length));this.slides[s].preload()}},o.prototype.createSpinner=function(i){var t={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#fff",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2,top:"50%",left:"50%"};this.spinner=new Spinner(t).spin(i[0])},o.prototype.setCursorFromHash=function(){var t=i.location.hash.replace(/^#/,"");Number(t)==t?this.show(Math.max(Math.min(this.length-1,Number(t)-1),0)):this.show(0)},o.prototype.show=function(t){void 0!==t&&(this.cursor=t),i.location.hash=this.cursor+1,this.$el.find(".slide").detach(),this.$el.append(this.slides[this.cursor].$el),this.loadNeighborhood(),this.setLabel("("+(this.cursor+1)+"/"+this.length+")")},o.prototype.setLabel=function(i){this.$label.text(this.$labelBase+" "+i)},o.prototype.bindHash=function(){s(i).on("hashchange",function(){this.setCursorFromHash()}.bind(this))},o.prototype.bindMouse=function(){this.$el.on("mousemove",function(){this.showControls()}.bind(this)),this.$el.on("click",function(){this.next(),this.showControls()}.bind(this))},o.prototype.bindKeys=function(){s(t).on("keydown",function(i){switch(i.keyCode){case 37:this.prev(),this.showControls();break;case 39:this.next(),this.showControls()}}.bind(this))},o}(window,document,jQuery);