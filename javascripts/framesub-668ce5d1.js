/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
!function(t,i){var e,s=t.jQuery||t.Cowboy||(t.Cowboy={});s.throttle=e=function(t,e,n,r){function a(){function s(){h=+new Date,n.apply(u,f)}function a(){o=i}var u=this,c=+new Date-h,f=arguments;r&&!o&&s(),o&&clearTimeout(o),r===i&&c>t?s():e!==!0&&(o=setTimeout(r?a:s,r===i?t-c:t))}var o,h=0;return"boolean"!=typeof e&&(r=n,n=e,e=i),s.guid&&(a.guid=n.guid=n.guid||s.guid++),a},s.debounce=function(t,s,n){return n===i?e(t,s,!1):e(t,n,s!==!1)}}(this),function(t){this.FrameInstance=t(jQuery)}(function(t){function i(i){{var e={};t.extend(!0,{},e,i)}return STATE={},EVENTS={},FrameSubsInstance=function(){return this.start()},FSI=FrameSubsInstance.prototype={constructor:FrameSubsInstance,start:function(){this.listenForMessages()},listenForMessages:function(){window.addEventListener("message",function(t){this.trigger(t.data.event,t.data.data)}.bind(this))},on:function(t,i){return void 0===EVENTS[t]&&(EVENTS[t]=[]),EVENTS[t].push(i),this},trigger:function(t){var i=EVENTS[t];if(void 0!==i)for(var e=i.length,s=0;e>s;s++)i[s].apply(this,arguments);return this},off:function(){}},new FrameSubsInstance}return i}),function(t){this.FrameSubs=t(jQuery)}(function(t){function i(i,s){var n={locateWith:e["data-attrs"]},r=t.extend(!0,{},n,s);return STATE={frames:[]},$ELEMENT=t(i),FrameSubsInstance=function(t){return this.start(t)},FSI=FrameSubsInstance.prototype={constructor:FrameSubsInstance,start:function(i){return this.options=t.extend(!0,{width:"auto",height:"auto"},i),this.$el=t(this.options.element),this.src=this.options.url,this.width=this.options.width,this.height=this.options.height,this.attach(),this.visible=void 0,this},attach:function(){this.frame=document.createElement("iframe"),this.$frame=t(this.frame),this.$frame.on("load",function(){this.loaded=!0,this.updateVisibility(),this.updateDimensions()}.bind(this)),this.$frame.attr("src",this.src),this.$frame.css({border:"none",height:this.height,width:this.width}),this.visible=!1,this.loaded=!1,this.$wrapper=t('<div class="framesub-wrapper"></div>'),this.$wrapper.append(this.$frame),this.$el.replaceWith(this.$wrapper)},detach:function(){this.$frame.replaceWith(this.$el)},requestSource:function(){this.postMessage("requestSource")},updateVisibility:function(){if(this.loaded){var t=this.isVisible();t!=this.visible&&this.trigger(t?"visible":"occluded"),this.visible=t}},updateDimensions:function(){this.loaded&&this.trigger("resize",{width:this.$wrapper.width(),height:this.$wrapper.height()})},isVisible:function(){var i=this.$frame.offset().top,e=this.$frame.outerHeight(),s=i+e,n=t(window).scrollTop(),r=t(window).height();return s>n&&n+r>i},trigger:function(t,i){this.postMessage({event:t,data:i})},postMessage:function(t){this.frame.contentWindow.postMessage(t,"*")},listenForMessages:function(){window.addEventListener("message",function(t){t.origin==window.location.origin})}},FrameSubsSet=function(){return this.start()},FSS=FrameSubsSet.prototype={constructor:FrameSubsSet,start:function(){if("function"==typeof r.locateWith)var i=r.locateWith($ELEMENT);else var i=e[r.locateWith]($ELEMENT);return t.each(i,function(i,e){var s=(t(e.element),new FrameSubsInstance(e));STATE.frames.push(s)}),this.onScroll(),this},checkFramePositions:t.throttle(200,function(){t.each(STATE.frames,function(t,i){i.updateVisibility()})}),updateDimensions:t.throttle(200,function(){t.each(STATE.frames,function(t,i){i.updateDimensions()})}),onScroll:function(){t(window).on("scroll resize",this.checkFramePositions.bind(this)),t(window).on("resize",this.updateDimensions.bind(this)),this.checkFramePositions()},offScroll:function(){t(window).off("scroll resize",this.checkFramePositions.bind(this)),t(window).off("resize",this.updateDimensions.bind(this))},frames:function(){return STATE.frames}},new FrameSubsSet}var e={"data-attrs":function(i){var e=[];return t(i).find("[data-frame-subs], [data-frame-subs-url]").each(function(i,s){var n=t(s);e.push({element:s,url:n.attr("data-frame-subs-url"),width:n.attr("data-frame-subs-width"),height:n.att("data-frame-subs-height")})}),e},"code-blocks":function(i){var e=[];return t(i).find("code").each(function(i,s){var n=t(s).html().trim(),r=n.match(/^interactive-frame(\[(.*)\])?\((.*)\)$/);if(r){var a=r[2].split(/\s+/),o=r[3],h={};t.each(a,function(t,i){var e=i.split(/=/);h[e[0]]=e[1]}),e.push(t.extend(h,{element:t(s).closest("p")||t(s),url:o}))}}),e}};return i});