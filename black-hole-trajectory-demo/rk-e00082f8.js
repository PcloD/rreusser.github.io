function rk4(r,f,e,a,n){var o,t,i,w,y,A=e;for(i=f.length,w=new Array(n),o=0;n>o;o++)w[o]=new Array(i);for(t=0;i>t;t++)w[0][t]=f[t];y=new Array(i);var u,v,h,k;for(o=0;n-1>o;o++){for(u=r(w[o],A),t=0;i>t;t++)y[t]=w[o][t]+.5*u[t]*a;for(v=r(y,A+.5*a),t=0;i>t;t++)y[t]=w[o][t]+.5*v[t]*a;for(h=r(y,A+.5*a),t=0;i>t;t++)y[t]=w[o][t]+h[t]*a;k=r(y,A+a);for(var t=0;i>t;t++)w[o+1][t]=w[o][t]+a/3*(.5*(u[t]+k[t])+v[t]+h[t]);if(A+=a,_.isNaN(w[o+1][0]))break}return w.slice(0,o+1)}function euler_step(r,f,e,a){var n,o,t,i;o=f.length,t=new Array(o),i=new Array(o);var w;for(w=r(f,e),n=0;o>n;n++)t[n]=f[n]+w[n]*a;return t}function rk4_step(r,f,e,a){var n,o,t,i;o=f.length,t=new Array(o),i=new Array(o);var w,y,A,u;for(w=r(f,e),n=0;o>n;n++)i[n]=f[n]+.5*w[n]*a;for(y=r(i,e+.5*a),n=0;o>n;n++)i[n]=f[n]+.5*y[n]*a;for(A=r(i,e+.5*a),n=0;o>n;n++)i[n]=f[n]+A[n]*a;u=r(i,e+a);for(var n=0;o>n;n++)t[n]=f[n]+a/3*(.5*(w[n]+u[n])+y[n]+A[n]);return t}function rk45(r,f,e,a,n,o){var t,i,w,y,A,u,v,h,k,l,s,c=e,g=a;for(h=f.length,k=new Array(n),u=0;n>u;u++)k[u]=new Array(h);for(v=0;h>v;v++)k[0][v]=f[v];for(l=new Array(h),u=0;n-1>u;u++){for(t=r(k[u],c),v=0;h>v;v++)l[v]=k[u][v]+.25*t[v]*a;for(i=r(l,c+.25*a),v=0;h>v;v++)l[v]=k[u][v]+a*(3/32*t[v]+9/32*i[v]);for(w=r(l,c+3*a/8),v=0;h>v;v++)l[v]=k[u][v]+a*(1932*t[v]-7200*i[v]+7296*w[v])/2197;for(y=r(l,c+12*a/13),v=0;h>v;v++)l[v]=k[u][v]+a*(439/216*t[v]-8*i[v]+3680/513*w[v]-845/4104*y[v]);for(A=r(l,c+a),v=0;h>v;v++)l[v]=k[u][v]+a*(-8/27*t[v]+2*i[v]-3544/2565*w[v]+1859/4104*y[v]-.275*A[v]);for(k6=r(l,c+.5*a),v=0;h>v;v++)l[v]=k[u][v]+a*(25/216*t[v]+1408/2565*w[v]+2197/4104*y[v]-.2*A[v]);for(v=0;h>v;v++)k[u+1][v]=k[u][v]+a*(16/135*t[v]+6656/12825*w[v]+28561/56430*y[v]-.18*A[v]+2/55*k6[v]);if(o){for(v=0,s=0;h>v;v++)s+=(l[v]-k[u+1][v])*(l[v]-k[u+1][v]);s=Math.sqrt(s),s>1e-6&&(a=Math.max(a/2,g/1024)),1e-8>s&&(a=Math.min(2*a,1024*g))}if(c+=a,_.isNaN(k[u+1][0]))break}return k.slice(0,u+1)}