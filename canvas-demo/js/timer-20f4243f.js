window.ART=window.ART||{},window.ART.Timer=function(){var t=Class.extend({init:function(t,i){this.t=t,this.callback=i||function(){},this.timeout=void 0},cancel:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0)},set:function(t){var i=this.t-t;i>=0&&(this.timeout=setTimeout(this.callback,i))}}),s=Class.extend({init:function(t,i){this.t=t,this.callback=i||function(){}},execute:function(t){return this.callback(t),this}}),e=Class.extend({init:function(t,i,s){this.start=t,this.end=i,this.callback=s,this.diff=this.end-this.start},tick:function(t){t>=this.start&&t<=this.end&&this.callback({t:t,start:this.start,end:this.end,progress:(t-this.start)/(this.end-this.start)})}}),n=Class.extend({init:function(){this.t0=Date.now(),this.pausedAt=this.t0,this.asyncEvents=[],this.timeouts=[],this.tickers=[],this.queuedEvents=[],this.executedEvents=[],this.stopTime=void 0,this.direction=1,this.onrewound=null,this.events={}},on:function(t,i){var s,e,n=t.split(/\s+/);for(s=n.length-1;s>=0;s--)e=n[s],void 0===this.events[e]&&(this.events[e]=[]),this.events[e].push(i);return this},trigger:function(t){var i,s,e,n,h,r=t.split(/\s+/);for(n=r.length-1;n>=0;n--)if(h=r[n],e=this.events[h],void 0!==e)for(s=e.length,i=0;s>i;i++)e[i].apply(this,arguments);return this},reset:function(){return this.t0=Date.now(),this.pausedAt=this.t0,this.queuedEvents=this.queuedEvents.concat(this.executedEvents),this.sortQueuedEvents(),this.trigger("reset"),this},play:function(t){if(t=$.extend({},t),this.direction=1,void 0===this.t0)this.t0=Date.now(),t.from&&(this.t0-=t.from),this.setTimeouts(),1==this.direction&&this.trigger("play");else if(void 0!==this.pausedAt){var i=Date.now()-this.pausedAt;t.from?this.t0=Date.now()-t.from:this.t0+=i,this.pausedAt=void 0,this.setTimeouts(),1==this.direction&&this.trigger("play")}return this},rewind:function(t){this.t0=Date.now()+t.from,this.direction=-1,this.pausedAt=void 0,this.setTimeouts(),this.trigger("rewind"),this.onrewound=t.rewound},pause:function(){return void 0===this.pausedAt&&(this.pausedAt=Date.now(),this.clearTimeouts(),this.trigger("pause")),this},stopAt:function(t,i){return this.stopTime=t,this.onStop=i,this},asyncAt:function(i,s){return this.asyncEvents.push(new t(i,s)),this},at:function(t,i){return this.queuedEvents.push(new s(t,i)),this},sortQueuedEvents:function(){return this.queuedEvents.sort(function(t,i){return t.t-i.t}),this},setTimeouts:function(){for(var t=Date.now()-this.t0,i=this.asyncEvents.length-1;i>=0;i--)this.asyncEvents[i].set(t);return this},clearTimeouts:function(){for(var t=this.asyncEvents.length-1;t>=0;t--)this.asyncEvents[t].cancel();return this},clearEvents:function(){for(;this.asyncEvents.length>0;)this.asyncEvents.unshift().cancel();return this},clearTickers:function(){for(;this.tickers.length>0;)this.tickers.unshift();return this},clearAll:function(){return this.clearEvents(),this.clearTickers(),this},between:function(t,i,s){return this.tickers.push(new e(t,i,s)),this},after:function(t,i){return this.tickers.push(new e(t,1/0,i)),this},until:function(t,i){return this.tickrs.push(new e(-(1/0),t,i)),this},tick:function(){var t=this.t,s=this.tickers.length;for(i=0;i<s;i++)this.tickers[i].tick(t);for(;this.queuedEvents.length>0&&this.queuedEvents[0].t<t;)this.executedEvents.unshift(this.queuedEvents.shift().execute(t));return void 0!==this.stopTime&&t>this.stopTime&&(this.pause(),this.pausedAt=this.t0+this.stopTime,this.trigger("stop")),0>t&&-1==this.direction&&(this.onrewound&&(this.onrewound(),this.onrewound=null),this.trigger("stop rewound")),this}});return Object.defineProperties(n.prototype,{t:{get:function(){return void 0===this.pausedAt?(Date.now()-this.t0)*this.direction:this.pausedAt-this.t0}},paused:{get:function(){return void 0!==this.pausedAt}},playing:{get:function(){return void 0===this.pausedAt}}}),n}();